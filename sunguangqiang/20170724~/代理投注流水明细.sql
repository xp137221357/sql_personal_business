set @param0 = '2017-06-26 12:00:00';
set @param1 = '2017-07-24 12:00:00';


-- 五星冷刀,辽宁妖狐,齐天球圣,足彩鬼谷子



select tf.* from report.t_partner_group t
inner join forum.t_user u on t.agent_acct_num=u.ACCT_NUM
inner join game.t_group_ref tf on tf.user_id=u.USER_CODE
where t.agent='足彩鬼谷子';

select func_getAllSonUser(426093,-1);

select '五星冷刀' 代理,u.NICK_NAME '用户昵称',u.ACCT_NUM '会员号',u.USER_MOBILE '联系方式',
sum(ifnull(t2.bet_coins,0)) '投注',
sum(ifnull(t2.prize_coins,0)) '返奖',
sum(ifnull(t2.effective_coins,0)) '有效流水'
from (
	select t.USER_ID from game.t_group_ref t where t.REF_ID in (
	418818,29630,42812,389237,390431,400821,405342,405387,405723,409104,411813,413421,413547,413748,414135,414159,414171,414210,415566,415626,418878,418995,419007,419010,419145,419148,419352,419610,419613,419616,419724,420060,420063,420066,420069,420192,420225,420240,420246,420276,420765,420810,421105,421599,421602,421629,421653,421755,421779,421971,422043,422100,422109,422184,422550,423303,423306,423492,423495,423498,423501,423672,423675,423687,424257,424425,424542,424851,424857,424860,424881,424893,424899,424908,424986,425058,425064,425415,425493,425505,425613,425970,426048,426402,426534,426597,426633,426651,426669,426690,426882,426930,427050,427482,427491,29633,420732,420735,420756,422670,422673,422676,422679,422682,422685,422688,422691,422694,422697,422700,422721,424809,425487,427212,390074,403257,413976,423609,423900,411816,412782,412821,419628,419829,419832,419913,420102,420174,421338,421563,422112,422169,422172,422244,422247,422277,422745,422946,423051,423120,423417,423435,423555,423564,423759,423762,423831,424125,424218,424383,424434,424566,424641,425112,425121,425259,425316,425355,425427,425430,425481,426057,426411,426417,426420,426447,426453,426468,426528,426603,426606,426609,426726,426948,426963,426972,426975,426984,426999,427008,427242,427386,427512,404436,405120,407709,412293,413478,413481,413649,413670,413676,413679,413946,414045,414063,414120,414312,414315,414321,414324,414375,414381,414384,414387,414390,414393,414408,414411,414414,414417,414420,414423,414426,414438,414441,414447,414450,414456,414459,414465,414468,414471,414474,414480,414483,414486,414489,414498,414534,414537,414543,414552,414564,414570,414573,414579,414582,414585,414633,414639,414645,414648,414663,414666,414675,414693,414696,414705,414747,414753,414774,414804,414807,413550,413973,413979,414021,413751,413853,413868,413877,413883,413886,413913,413925,413928,413964,413967,413970,414000,414003,414060,414075,414090,414093,414102,414105,414123,414228,414231,414234,414237,414240,414252,414333,414336,414345,414477,414516,414657,414717,414783,414786,414795,414825,414930,414951,415002,415026,415155,415167,415362,415377,415500,415524,415530,415533,415536,415749,415827,415920,416106,416112,416127,416169,416181,416250,416283,416463,416553,416625,416634,416661,416871,416886,416889,416991,417042,417045,417066,417072,417192,417258,417642,417789,418035,418050,418452,418476,418503,418698,418773,419814,414357,417930,418143,418146,418158,418161,418176,418449,418491,422364,423213,423234,425004,426915,427407,418881,418887,424524,419262,419307,420099,425748,420771,420876,420966,421605,421620,421623,422508,423015,423123,424269,423795,425691,427434,427437,422568,423432,425280,425289,425313,425358,425364,425370,425373,425412,424632,424812,424815,424818,424821,424824,424998,424902,424941,426372,427497,425418,425529,425532,425640,426720,426951,390077,404439,404448,405123,420330,418479,420888,414687,414873,415035,426585,414513,414558,414654,414903,414915,414918,416172,418632,419979,419982,420696,420726,422448,422469,422769,423351,422367,423243,423909,424281,427362,427365,425334,426828,427071,427113,427209,427236,427257,427419,426987,427035,427374,427377,414561,419238,421104,421122,422370,423309,423312,426699,427224,426588,426594,426600,427218,427239,427380,
	418251,418254,419496,419502,421467,421491,423738,423828,423948,423993,424539,425073,425502,425517,425523,422301,423903,
	50972,50975,51356,388634,402708,417888,420132,420138,420795,421662,422304,425169,425196,425706,426537,426837,427083,427086,427101,427104,427122,427161,427233,427251,427338,427488,427503,427515,422307,
	426093,426141,426222,426249,426885,426888,426909,427428
	)
)t1
inner join forum.t_user u on t1.user_id=u.USER_CODE
left join (
	select o.USER_ID,
	sum(o.COIN_BUY_MONEY) bet_coins, 
	ifnull(sum(o.COIN_PRIZE_MONEY),0)+ifnull(sum(o.COIN_RETURN_MONEY),0) prize_coins,
	sum(
	    if(o.pass_type = '1001' 
		 and o.item_status not in (0,10,-5,-10,120,210) 
		 and o.MATCH_ODDS >= 1.5,
		 abs(ifnull(o.COIN_BUY_MONEY,0) - ifnull(o.COIN_PRIZE_MONEY,0)-ifnull(o.COIN_RETURN_MONEY,0)),
		 0 )) effective_coins
	from (
		select o.USER_ID,o.COIN_BUY_MONEY,o.COIN_PRIZE_MONEY,o.COIN_RETURN_MONEY,c.MATCH_ODDS,o.PASS_TYPE,o.ITEM_STATUS from game.t_order_item o 
		inner join (
			select t.USER_ID,t.CRT_TIME from game.t_group_ref t where t.REF_ID in (
			418818,29630,42812,389237,390431,400821,405342,405387,405723,409104,411813,413421,413547,413748,414135,414159,414171,414210,415566,415626,418878,418995,419007,419010,419145,419148,419352,419610,419613,419616,419724,420060,420063,420066,420069,420192,420225,420240,420246,420276,420765,420810,421105,421599,421602,421629,421653,421755,421779,421971,422043,422100,422109,422184,422550,423303,423306,423492,423495,423498,423501,423672,423675,423687,424257,424425,424542,424851,424857,424860,424881,424893,424899,424908,424986,425058,425064,425415,425493,425505,425613,425970,426048,426402,426534,426597,426633,426651,426669,426690,426882,426930,427050,427482,427491,29633,420732,420735,420756,422670,422673,422676,422679,422682,422685,422688,422691,422694,422697,422700,422721,424809,425487,427212,390074,403257,413976,423609,423900,411816,412782,412821,419628,419829,419832,419913,420102,420174,421338,421563,422112,422169,422172,422244,422247,422277,422745,422946,423051,423120,423417,423435,423555,423564,423759,423762,423831,424125,424218,424383,424434,424566,424641,425112,425121,425259,425316,425355,425427,425430,425481,426057,426411,426417,426420,426447,426453,426468,426528,426603,426606,426609,426726,426948,426963,426972,426975,426984,426999,427008,427242,427386,427512,404436,405120,407709,412293,413478,413481,413649,413670,413676,413679,413946,414045,414063,414120,414312,414315,414321,414324,414375,414381,414384,414387,414390,414393,414408,414411,414414,414417,414420,414423,414426,414438,414441,414447,414450,414456,414459,414465,414468,414471,414474,414480,414483,414486,414489,414498,414534,414537,414543,414552,414564,414570,414573,414579,414582,414585,414633,414639,414645,414648,414663,414666,414675,414693,414696,414705,414747,414753,414774,414804,414807,413550,413973,413979,414021,413751,413853,413868,413877,413883,413886,413913,413925,413928,413964,413967,413970,414000,414003,414060,414075,414090,414093,414102,414105,414123,414228,414231,414234,414237,414240,414252,414333,414336,414345,414477,414516,414657,414717,414783,414786,414795,414825,414930,414951,415002,415026,415155,415167,415362,415377,415500,415524,415530,415533,415536,415749,415827,415920,416106,416112,416127,416169,416181,416250,416283,416463,416553,416625,416634,416661,416871,416886,416889,416991,417042,417045,417066,417072,417192,417258,417642,417789,418035,418050,418452,418476,418503,418698,418773,419814,414357,417930,418143,418146,418158,418161,418176,418449,418491,422364,423213,423234,425004,426915,427407,418881,418887,424524,419262,419307,420099,425748,420771,420876,420966,421605,421620,421623,422508,423015,423123,424269,423795,425691,427434,427437,422568,423432,425280,425289,425313,425358,425364,425370,425373,425412,424632,424812,424815,424818,424821,424824,424998,424902,424941,426372,427497,425418,425529,425532,425640,426720,426951,390077,404439,404448,405123,420330,418479,420888,414687,414873,415035,426585,414513,414558,414654,414903,414915,414918,416172,418632,419979,419982,420696,420726,422448,422469,422769,423351,422367,423243,423909,424281,427362,427365,425334,426828,427071,427113,427209,427236,427257,427419,426987,427035,427374,427377,414561,419238,421104,421122,422370,423309,423312,426699,427224,426588,426594,426600,427218,427239,427380,
			418251,418254,419496,419502,421467,421491,423738,423828,423948,423993,424539,425073,425502,425517,425523,422301,423903,
			50972,50975,51356,388634,402708,417888,420132,420138,420795,421662,422304,425169,425196,425706,426537,426837,427083,427086,427101,427104,427122,427161,427233,427251,427338,427488,427503,427515,422307,
			426093,426141,426222,426249,426885,426888,426909,427428
			)
		) t on o.USER_ID=t.USER_ID
		left join game.t_item_content c on c.ITEM_ID = o.item_id
		where o.CHANNEL_CODE in ('game')
		and o.BALANCE_TIME>=@param0
		and o.BALANCE_TIME<@param1
		and o.CRT_TIME>t.CRT_TIME
		group by o.ITEM_ID
	) o
   group by o.USER_ID
) t2 on t2.user_id=t1.user_id;

